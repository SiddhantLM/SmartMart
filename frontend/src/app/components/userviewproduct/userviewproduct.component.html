<div class="page-wrapper">
  <!-- Product Details -->
  <div class="product-container">
    <div class="product-image">
      <img [src]="product.photoImage" alt="Product" />
    </div>
    <div class="product-info">
      <h2>{{ product.name }}</h2>
      <p>{{ product.description }}</p>
      <p><strong>Price:</strong> â‚¹{{ product.price }}</p>
      <p><strong>Qty:</strong> {{ product.stock }} units</p>

      <div class="rating">
        <ng-container *ngFor="let star of stars; let i = index">
          <i class="fa-star" [ngClass]="i < averageRating ? 'fa-solid' : 'fa-regular'"></i>
        </ng-container>
        <span>({{ averageRating || 0 }})</span>
      </div>

      <div *ngIf="product.stock > 0; else notifyBlock" class="action-section">
        <input type="number" [(ngModel)]="selectedQty" min="1" [max]="product.stock" />
        <button (click)="addToCart()">Add</button>
      </div>

      <ng-template #notifyBlock>
        <div class="notify-section">
          <input type="email" [(ngModel)]="email" placeholder="Example@gmail.com" />
          <button (click)="notifyMe()">Notify Me</button>
        </div>
      </ng-template>

      <div class="wishlist-section">
        <button (click)="toggleWishList($event)">
          <i class="fa-heart" [ngClass]="isLiked ? 'fa-solid' : 'fa-regular'"></i>
          Add to Wishlist</button>
        
      </div>
    </div>
  </div>

  <!-- Reviews Section -->
  <div class="reviews-container">
    <h3>User Reviews</h3>

    <div class="review-summary" *ngIf="summary || summaryLoading">
      <h4>Review Summary</h4>

      <div *ngIf="summaryLoading" class="summary-loading">
        Generating summary...
      </div>

      <div *ngIf="!summaryLoading && summary" 
           [innerHTML]="summary">
      </div>

    </div>

    <!-- Add Review Button -->
    <div class="add-review-btn">
      <button (click)="reviewFormVisible = !reviewFormVisible">
        {{ reviewFormVisible ? 'Cancel' : 'Write a Review' }}
      </button>
    </div>

    <!-- Review Form -->
    <div class="review-form" *ngIf="reviewFormVisible">
      <h4>Rate this product</h4>
      <div class="star-rating">
        <i class="fa-star fa-2x"
           *ngFor="let star of stars; let i = index"
           [ngClass]="i < newReview.rating! ? 'fa-solid' : 'fa-regular'"
           (click)="newReview.rating = i + 1" onkeypress=""></i>
      </div>
      <textarea [(ngModel)]="newReview.content" placeholder="Write your review..." rows="4"></textarea>
      <button (click)="submitReview()" [disabled]="!newReview.rating || !newReview.content?.trim()">
        Submit Review
      </button>
    </div>

    <div class="review-scroll">
      <div class="review-card" *ngFor="let review of reviews">
        <h4>{{ review.user?.username || 'Anonymous' }}</h4>
        <p>
          Rating:
          <ng-container *ngFor="let star of stars; let i = index">
            <i class="fa-star" [ngClass]="i < (review.rating || 0) ? 'fa-solid' : 'fa-regular'"></i>
          </ng-container>
        </p>
        <p>{{ review.content }}</p>
      </div>
      <div class="review-card" *ngIf="reviews.length === 0">
        <p>No reviews yet. Be the first!</p>
      </div>
    </div>
  </div>
</div>

<!-- Toast Notification -->
<div class="toast" *ngIf="showToast" [ngClass]="toastType">
  {{ toastMessage }}
</div>